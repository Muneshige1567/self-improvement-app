# 07. UI/UX設計

> **前提文書**: `ios-requirements.md` v2.0, `character-style-guide.md` v1.0, `requirements-review.md` v1.0
> **本セクションの位置づけ**: 画面一覧・遷移図・入力UX・デザインスタイルガイド・オンボーディングの完全版。レビュー指摘（P1: 画面遷移の抜け漏れ、通知ディープリンク）を全て反映

---

## 7.1 画面一覧

| # | 画面名 | 概要 | MVP |
|---|---|---|---|
| 1 | **オンボーディング** | 初回起動時の世界観導入 + 設定 | YES |
| 2 | **ホーム** | 今日のスコア入力状況 + Quick/Deep モード選択 + ストリーク | YES |
| 3 | **チェック入力（Quick）** | 25項目をカテゴリごとにスワイプ、各項目を 1-5 タップ | YES |
| 4 | **チェック入力（Deep）** | Quick の入力 + カテゴリごとのメモ入力欄 | YES |
| 5 | **デイリーサマリー** | 当日のレーダーチャート + スコア一覧 + 即時フィードバック | YES |
| 6 | **フィードバック詳細** | カテゴリ別詳細分析 + トレンドグラフ + 推奨アクション | YES |
| 7 | **週次サマリー** | 7日間の総括 + カテゴリハイライト + 来週フォーカス | v1.1 |
| 8 | **ダッシュボード** | 週次 / 月次 / ロングタームの推移グラフ切り替え | v1.1 |
| 9 | **項目詳細** | 特定項目の時系列推移 + エビデンス参照 | v1.1 |
| 10 | **マイルストーン達成** | マイルストーン到達時の特別演出画面 | YES |
| 11 | **設定** | 通知時刻、AI設定、データエクスポート、アプリ情報 | YES |

---

## 7.2 画面遷移図（矛盾解消版）

requirements-review.md の改善提案を反映した完全版。通知タップ先を含む。

```
オンボーディング（初回起動時のみ）
  → ホーム

ホーム
├── [Quick開始] → チェック入力（Quick）
│                  └── [入力完了] → デイリーサマリー（+ 即時フィードバック）
│                                     └── [詳細を見る] → フィードバック詳細
├── [Deep開始]  → チェック入力（Deep）
│                  └── [入力完了] → デイリーサマリー（+ 即時フィードバック）
│                                     └── [詳細を見る] → フィードバック詳細
├── [ストリークタップ] → マイルストーン達成（到達時）/ ストリーク履歴
├── [ダッシュボード] → ダッシュボード                    [v1.1]
│                      ├── 週次ビュー → 週次サマリー     [v1.1]
│                      ├── 月次ビュー                    [v1.1]
│                      ├── ロングタームビュー             [v1.2]
│                      └── [カテゴリ/項目タップ] → 項目詳細 [v1.1]
├── [項目タップ] → 項目詳細                              [v1.1]
└── [設定] → 設定
             ├── 通知設定（朝/昼/夜/週次の時刻・オン/オフ）
             ├── AI設定（APIキー入力・有効/無効）
             ├── データエクスポート                       [v1.1]
             └── アプリ情報

通知タップからの遷移:
├── 朝の檄文タップ        → ホーム
├── 陣中見舞いタップ      → ホーム
├── 夕べの下知タップ      → モード選択（ホーム画面のQuick/Deep選択部分）
│   ├── [Quick開始]ボタン → チェック入力（Quick）
│   └── [Deep開始]ボタン  → チェック入力（Deep）
├── 前日総括タップ        → デイリーサマリー（昨日分）
├── 週次総括タップ        → 週次サマリー                  [v1.1]
├── マイルストーンタップ  → マイルストーン達成画面
└── リマインド（後で）タップ → モード選択
```

---

## 7.3 入力UX

### 7.3.1 Quick モード

```
構成: 5カテゴリ × 5項目 = 25項目
操作: スワイプ（カテゴリ切替）+ タップ（スコア選択）
所要時間: 2-3分

フロー:
  1. ホーム画面で「Quick開始」をタップ
  2. カテゴリ1（Perceive / 眼）の5項目が表示
  3. 各項目の横に 1-5 のスコアボタン
  4. スコアをタップすると墨が染みるアニメーション + ハプティクス
  5. 右スワイプで次のカテゴリ（Think / 知）へ
  6. 5カテゴリ全て完了すると「完了」ボタンが出現
  7. 「完了」タップ → デイリーサマリーへ遷移

1画面の構成:
  ┌──────────────────────────────────────┐
  │  眼（Perceive）           2/5 完了   │  ← カテゴリ名 + 進捗
  │──────────────────────────────────────│
  │  P1: 一次ソースに当たる              │
  │  ○ ○ ○ ○ ○                          │  ← 1-5 スコアボタン
  │                                      │
  │  P2: 自分のバイアスを疑う            │
  │  ○ ○ ● ○ ○                          │  ← 3が選択済み
  │                                      │
  │  P3: 不確実な中で判断を下す          │
  │  ○ ○ ○ ● ○                          │  ← 4が選択済み
  │                                      │
  │  P4: シグナルとノイズを分ける        │
  │  ○ ○ ○ ○ ○                          │  ← 未選択
  │                                      │
  │  P5: 変化の兆しを捉える             │
  │  ○ ○ ○ ○ ○                          │
  │──────────────────────────────────────│
  │  ● ○ ○ ○ ○                          │  ← カテゴリインジケータ
  └──────────────────────────────────────┘
```

### 7.3.2 Deep モード

```
構成: Quick の全要素 + カテゴリごとのメモ入力欄
操作: Quick と同じスコア入力 + テキスト入力
所要時間: 10-15分

追加要素:
  各カテゴリのスコア入力後にテキスト入力欄が出現。
  プレースホルダー: 「今日の"眼"について気づいたこと...」
  スキップ可能（メモは任意）。

  ┌──────────────────────────────────────┐
  │  眼（Perceive）           5/5 完了   │
  │──────────────────────────────────────│
  │  （5項目のスコア入力部分）            │
  │──────────────────────────────────────│
  │  今日の"眼"について                  │
  │  ┌────────────────────────────────┐  │
  │  │ 今日の会議で、伝聞情報だけで    │  │  ← テキスト入力欄
  │  │ 判断しそうになった。一次ソース   │  │
  │  │ に当たる意識が足りなかった。     │  │
  │  └────────────────────────────────┘  │
  │                        [スキップ →]  │
  └──────────────────────────────────────┘
```

### 7.3.3 入力中断の挙動

```
一時保存（ドラフト）:
  - 入力途中のスコアは自動的にドラフトとして端末に保存
  - アプリがバックグラウンドに移行した場合も保持
  - アプリ再起動時にドラフトが存在する場合、復元ダイアログを表示:
    「前回の入力途中のデータがあります。続きから再開しますか？」
    [再開する] [破棄する]

  - 明示的な「破棄」操作時は確認ダイアログ:
    「入力途中のデータを破棄しますか？この操作は取り消せません。」
    [破棄する] [戻る]
```

### 7.3.4 04:00をまたぐ入力

```
ルール: 入力開始時点の論理日付を採用する

例1: 2/14 03:50 に入力開始 → 論理日付 = 2/13（04:00区切り）
     2/14 04:10 に入力完了 → DailyRecord.date = 2/13

例2: 2/14 04:05 に入力開始 → 論理日付 = 2/14
     2/14 04:20 に入力完了 → DailyRecord.date = 2/14

論理日付の計算:
  IF currentTime.hour < 4:
    logicalDate = currentDate - 1day
  ELSE:
    logicalDate = currentDate
```

### 7.3.5 同日再入力

```
ルール: UPSERT（上書き）

- 同一論理日付の DailyRecord が既に存在する場合:
  - Score は itemId をキーに UPSERT（新しいスコアで上書き）
  - CategoryMemo は category をキーに UPSERT
  - 即時フィードバックは最新スコアで再生成
  - AIキャッシュは破棄して再生成

- ホーム画面の表示:
  記録済みの日は「修正する」ボタンを表示（「Quick開始」「Deep開始」の代わりに）
```

---

## 7.4 デザインスタイルガイド

### 7.4.1 デザインコンセプト

**「現代の道場」**

伝統的な和の美意識を、現代のiOSデザインに昇華させる。
「古臭い和風」ではなく「洗練された和モダン」を目指す。

キーワード: 余白、墨、静謐、凛、温もり

### 7.4.2 カラーパレット

#### プライマリカラー

| 名前 | 用途 | Hex | 和色名 |
|---|---|---|---|
| **墨** | 背景（ダークモード主体） | `#1A1A1A` | 墨色（すみいろ） |
| **生成** | 背景（ライトモード） | `#F5F0E8` | 生成色（きなりいろ） |
| **藍** | アクセント・リンク | `#1B4B6B` | 藍色（あいいろ） |
| **朱** | 警告・叱咤・低スコア | `#C13B2A` | 朱色（しゅいろ） |
| **金** | 称賛・マイルストーン | `#B8860B` | 金茶（きんちゃ） |

#### カテゴリカラー（レーダーチャート・カテゴリ識別）

| カテゴリ | Hex | 和色名 | 選定理由 |
|---|---|---|---|
| Perceive（眼） | `#4A7C59` | 千歳緑（ちとせみどり） | 冷静な観察。常緑の知恵 |
| Think（知） | `#2E4F7B` | 紺色（こんいろ） | 深い思考。藍より深い知性 |
| Execute（剣） | `#8B2500` | 弁柄色（べんがらいろ） | 熱い実行力。刀の鍛冶の火 |
| Engage（人） | `#C17817` | 山吹色（やまぶきいろ） | 人との温かい交わり |
| Sustain（道） | `#5B4A6A` | 江戸紫（えどむらさき） | 高貴な修行。持続の気品 |

#### スコアカラー

| スコア | 色 | 意味 |
|---|---|---|
| 5 | `#B8860B`（金茶） | 卓越 |
| 4 | `#4A7C59`（千歳緑） | 良好 |
| 3 | `#6B6B6B`（灰色） | 普通 |
| 2 | `#C17817`（山吹） | 要注意 |
| 1 | `#C13B2A`（朱色） | 要改善 |

### 7.4.3 タイポグラフィ

| 用途 | フォント | ウェイト | サイズ | フォールバック |
|---|---|---|---|---|
| 武士のセリフ | **游明朝体**（YuMincho） | Demibold | 17pt | YuMincho Medium → HiraMinProN-W6 → system serif |
| 見出し | **ヒラギノ角ゴシック** | W6 | 20pt | system default |
| 本文 | **ヒラギノ角ゴシック** | W3 | 15pt | system default |
| スコア数値 | **SF Pro Display** | Bold | 36pt | system default |
| キャプション | **ヒラギノ角ゴシック** | W3 | 12pt | system default |

設計意図:
- 武士のセリフのみ明朝体。筆の運びを感じさせる
- UI全体はゴシック体で現代的な可読性を確保
- スコア数値は SF Pro で視認性最優先

### 7.4.4 UIコンポーネント

#### カード

```
背景: 半透明の和紙テクスチャ（opacity: 0.05 程度。主張しすぎない）
角丸: 8pt（和の直線的な美意識を保つ。丸すぎない）
ボーダー: なし。影のみ（影色: #000000 opacity 0.08）
内部パディング: 16pt
```

#### フィードバック表示エリア

```
背景: 縦書き巻物のメタファー（ただしテキストは横書き）
上下に巻物の端を模した装飾ライン
フォント: 游明朝体
テキストカラー:
  ダークモード時: #E8E0D0（生成色の明るい版）
  ライトモード時: #2A2A2A
```

#### スコア入力ボタン

```
形状: 正方形（角丸4pt）
サイズ: 44x44pt（タップ領域確保）
未選択時: ボーダーのみ（1pt, カテゴリカラー opacity 0.3）
選択時: カテゴリカラーで塗りつぶし + 白テキスト
アニメーション: タップ時に墨が染みるようなフィルアニメーション（0.2s ease-out）
ハプティクス: UIImpactFeedbackGenerator(.light)
```

#### レーダーチャート

```
5角形（5カテゴリ）
線色: カテゴリカラー
塗り: カテゴリカラー opacity 0.15
当日データ: 実線 + 塗り
7日平均: 破線のみ（比較用）
軸ラベル: カテゴリの武士道呼称（眼・知・剣・人・道）
背景: 同心の5角形グリッド（5段階に対応）
実装: Swift Charts ではなくカスタム Shape + Canvas で実装
```

#### ストリーク表示

```
アイコン: 和風の松明（たいまつ）アイコン（絵文字ではない）
連続日数: SF Pro Bold 36pt
ラベル: 「連続 ○日」
マイルストーン到達時: 金色のグロー効果
```

### 7.4.5 アイコンシステム

| アイコン | モチーフ | 用途 |
|---|---|---|
| Perceive | 目（書道的な一筆書き） | カテゴリ識別 |
| Think | 筆と巻物 | カテゴリ識別 |
| Execute | 刀 | カテゴリ識別 |
| Engage | 向かい合う人（家紋風） | カテゴリ識別 |
| Sustain | 道（遠近法の一本道） | カテゴリ識別 |
| Quick モード | 居合い抜き（一閃） | モード選択 |
| Deep モード | 座禅 | モード選択 |
| ストリーク | 松明 | ストリーク表示 |
| マイルストーン | 家紋 | 達成時表示 |

MVP ではカスタムアイコンの代わりに SF Symbols を使用。v1.1 でカスタムアイコンセットに差し替え。

### 7.4.6 アニメーション指針

| シーン | アニメーション | 時間 | イージング |
|---|---|---|---|
| スコアタップ | 墨が染みるフィル | 0.2s | ease-out |
| カテゴリ切り替え | 横スワイプ（巻物を広げる） | 0.3s | ease-in-out |
| フィードバック表示 | 下からフェードイン | 0.4s | ease-out |
| マイルストーン達成 | 金色の波紋エフェクト | 1.0s | ease-out |
| レーダーチャート描画 | 中心から頂点に向かって線が伸びる | 0.6s | ease-out |

全体方針: アニメーションは控えめ。「静」の中に「動」があるという和の美意識。派手なエフェクトは避ける。

### 7.4.7 ダークモード / ライトモード

| 要素 | ダークモード | ライトモード |
|---|---|---|
| 背景 | `#1A1A1A`（墨色） | `#F5F0E8`（生成色） |
| テキスト | `#E8E0D0` | `#2A2A2A` |
| カード背景 | `#2A2A2A` | `#FFFFFF` |
| 武士セリフ | `#E8E0D0` | `#3A2A1A`（焦茶） |
| アクセント | 変更なし | 変更なし |

**推奨デフォルト: ダークモード**
理由: 夜の使用が主（22時のリマインド）。墨色の背景が和の世界観と合致。

MVP はダークモードのみ。ライトモードは v1.1 で対応。

---

## 7.5 オンボーディング

初回起動時の体験。ユーザーを立花一門の世界に導入し、アプリの使い方を伝える。

### 7.5.1 フロー（5画面のスワイプ型）

#### 画面1: 世界観導入

```
┌──────────────────────────────────────┐
│                                      │
│           [立花家の家紋]              │
│                                      │
│     「あなたは立花宗茂である」        │   ← 游明朝体 Demibold
│                                      │
│  養父・立花道雪から兵法を学び、       │
│  実父・高橋紹運から覚悟を受け継ぎ、   │
│  妻・誾千代に叱咤され、               │
│  忠実な家臣団に支えられながら、       │
│  「西国無双」への道を歩む。           │
│                                      │
│              [次へ →]                │
│  ○ ○ ○ ○ ○                          │
└──────────────────────────────────────┘
```

#### 画面2: 5カテゴリ紹介

```
┌──────────────────────────────────────┐
│                                      │
│     「五つの鍛錬で己を磨け」          │
│                                      │
│  [目] 眼（Perceive）— 情報を正しく   │
│       集め、判断する                  │
│                                      │
│  [巻物] 知（Think）— 構造的に、      │
│         深く、鋭く考え抜く            │
│                                      │
│  [刀] 剣（Execute）— 速く、高品質に、│
│       やり抜いて形にする              │
│                                      │
│  [人] 人（Engage）— 伝え、聞き、     │
│       巻き込み、信頼を築く            │
│                                      │
│  [道] 道（Sustain）— 学び続け、      │
│       長期的に伸びる                  │
│                                      │
│              [次へ →]                │
│  ○ ● ○ ○ ○                          │
└──────────────────────────────────────┘
```

#### 画面3: スコアの付け方ガイド

```
┌──────────────────────────────────────┐
│                                      │
│      「日々の己を数で記せ」           │
│                                      │
│  5  卓越した行動ができた              │  ← 金茶
│     他者にも良い影響を与えた          │
│                                      │
│  4  意識的に良い行動ができた          │  ← 千歳緑
│                                      │
│  3  ある程度できた（普通）            │  ← 灰色
│                                      │
│  2  意識はしたが行動に至らなかった    │  ← 山吹
│                                      │
│  1  まったくできなかった              │  ← 朱色
│     意識すらしなかった                │
│                                      │
│  毎日2分。完璧を目指さなくてよい。    │
│  記録を続けること自体が鍛錬である。   │
│                                      │
│              [次へ →]                │
│  ○ ○ ● ○ ○                          │
└──────────────────────────────────────┘
```

#### 画面4: 通知時刻設定

```
┌──────────────────────────────────────┐
│                                      │
│    「一門があなたに語りかける」        │
│                                      │
│  朝の檄文（道雪）                    │
│  [07:00]  ← 時刻ピッカー             │
│  「今日の心構えを授ける」             │
│                                      │
│  陣中見舞い（家臣団）                │
│  [12:30]  ← 時刻ピッカー             │
│  「午後の行動を促す」                 │
│                                      │
│  夕べの下知（誾千代）                │
│  [22:00]  ← 時刻ピッカー             │
│  「振り返りの入力を誘導する」         │
│                                      │
│              [次へ →]                │
│  ○ ○ ○ ● ○                          │
└──────────────────────────────────────┘

※ このタイミングで通知許可ダイアログを表示
```

#### 画面5: AIフィードバック設定

```
┌──────────────────────────────────────┐
│                                      │
│    「知将の助言を受けるか？」          │
│                                      │
│  AIフィードバックを有効にすると、     │
│  立花一門がスコアに基づいた           │
│  文脈依存の助言をくれます。           │
│                                      │
│  [APIキーを入力]                      │
│  ┌────────────────────────────────┐  │
│  │ sk-ant-...                      │  │  ← セキュア入力
│  └────────────────────────────────┘  │
│                                      │
│  APIキーは端末内に暗号化保存されます。│
│  スコア数値のみ送信し、               │
│  メモ本文は送信しません。             │
│                                      │
│  [スキップ（テンプレートで開始）]      │
│                                      │
│           [始める]                    │  ← メインCTA
│  ○ ○ ○ ○ ●                          │
└──────────────────────────────────────┘
```

### 7.5.2 オンボーディング完了後

```
オンボーディング完了
  → ホーム画面に遷移
  → 初回のみ道雪のウェルカムメッセージを表示:
    「宗茂よ、今日からお主の修行が始まる。
     恐れるな。某がついておる。」
  → 完了フラグを UserDefaults に保存（2回目以降はスキップ）
```

---

## 7.6 ウィジェット仕様

### 7.6.1 ホーム画面ウィジェット

```
サイズ: Small（2x2）/ Medium（4x2）

Small:
  ┌────────────────┐
  │  3.8  ↑        │  ← 総合スコア + トレンド矢印
  │  連続14日       │  ← ストリーク
  │                │
  │  「今日の動き、 │  ← 武将の一言（1行）
  │   見事であった」│
  └────────────────┘

Medium:
  ┌────────────────────────────────────┐
  │  3.8  ↑  連続14日                  │  ← スコア + トレンド + ストリーク
  │──────────────────────────────────────│
  │  眼 3.6  知 4.0  剣 4.2  人 3.8  道 3.4  │  ← カテゴリ別ミニバー
  │──────────────────────────────────────│
  │  「今日の"剣"、切れ味が違ったな」    │  ← 武将の一言
  │  「敵を知り己を知れば百戦危うからず」│  ← 名言
  └────────────────────────────────────┘

表示内容:
  - 今日のスコア（未入力時は「---」）
  - 7日移動平均との比較（↑ / ↓ / →）
  - ストリーク日数
  - 武将の一言（最新のフィードバックnotification文）
  - 名言（武士道・兵法書からの引用。日替わり）

タップ時: アプリのホーム画面に遷移
```

### 7.6.2 ロック画面ウィジェット

```
サイズ: Inline / Circular / Rectangular

Inline:
  「連続14日 | 3.8 ↑」

Circular:
  ┌────┐
  │ 14 │  ← ストリーク日数（大きく）
  │ 日 │
  └────┘

Rectangular:
  ┌──────────────┐
  │ 連続14日  3.8│
  │「刀を磨き   │  ← 名言（1行）
  │ 続けよ」    │
  └──────────────┘

タップ時: アプリのホーム画面に遷移
```

### 7.6.3 ウィジェット更新タイミング

```
更新トリガー:
  1. チェック完了時: WidgetCenter.shared.reloadAllTimelines()
  2. 朝の通知時: Timeline のエントリーとしてスケジュール
  3. 04:00（日付変更時）: 新しい論理日付に切り替え

データ共有:
  - App Group を使用してメインアプリとウィジェット間でデータ共有
  - 共有データ: 最新のスコア、ストリーク日数、最新フィードバックテキスト、名言

Timeline Provider:
  - getTimeline() で次の更新ポイント（04:00, 朝の通知時刻）をエントリーとして返却
  - スコア未入力状態では placeholder 表示
```

---

## 7.7 サウンド指針（オプション）

| シーン | サウンド | 特徴 |
|---|---|---|
| スコアタップ | 木魚の軽い音 or 無音 | 連続タップ時に煩くならないよう最小限 |
| チェック完了 | 鈴（りん）の一打ち | 禅寺の鈴。完了の区切り |
| マイルストーン | 太鼓の一打ち | 重みのある達成感 |
| デフォルト | 無音 | 基本は無音。サウンドは設定でオン |

MVP ではサウンドは実装しない（v1.2）。

---

## 7.8 数値の和風変換ルール

フィードバック等で武士のセリフに数値を含む場合の変換ルール。

```
スコア表示（UI上）: アラビア数字のまま（視認性優先）
  例: 4.2 → 「4.2」

セリフ内の数値: 文脈で使い分け
  連続日数: 漢数字（「七日」「三十日」「六十六日」）
  スコア差分: 漢数字（「〇・五の向上」）
  順位: 序数（「第一の領域」）

日付: 和暦は使用しない（実用性を損なうため）
```

---

## 7.9 名言カード仕様

04_characters.md 4.2 で定義された名言をアプリ内で常時表示する。

### 7.9.1 ホーム画面の日替わり名言カード

```
表示位置: ホーム画面上部（ストリーク表示の下、モード選択ボタンの上）
サイズ: 横幅100%（左右パディング20pt）、高さは内容に応じて可変
背景: 半透明の和紙テクスチャ（opacity: 0.03）
フォント: 游明朝体 Demibold 20pt
テキストカラー: #E8E0D0（ダークモード）/ #3A2A1A（ライトモード）
出典: 名言下部に人物名を小さく表示（ヒラギノ角ゴ W3 12pt, opacity 0.6）
枠: 上下に細い金茶のライン（0.5pt）
パディング: 上下24pt、左右20pt
タップ動作: 名言一覧画面へ遷移
選出ロジック: 日付ベースのローテーション。お気に入り登録された名言を優先
```

### 7.9.2 ロード/遷移時の名言表示

```
表示タイミング: 画面遷移の間（特にチェック入力→デイリーサマリーの遷移時）
表示方式: 画面中央にフェードイン（0.8s ease-in-out）→ 0.5s保持 → フェードアウト（0.5s）
フォント: 游明朝体 Demibold 17pt
背景: 墨色（全画面オーバーレイ）
選出ロジック: ランダム。直前と重複しない
```

### 7.9.3 デイリーサマリーの名言表示

```
表示位置: デイリーサマリー画面の最下部
選出ロジック: 当日のスコアに最も関連するカテゴリの名言を選出
  - 最高カテゴリ or 最低カテゴリの接続カテゴリ（04_characters.md 4.2.1 参照）で選出
  - 同一カテゴリに複数名言がある場合はランダム
```

### 7.9.4 名言一覧画面

```
表示: 全名言をリスト表示（宗茂 → 道雪 → 紹運の順）
お気に入り: 各名言にハートアイコン。タップでお気に入り登録/解除
フィルタ: 「全て」「お気に入り」のセグメントコントロール
各名言の表示:
  - 名言テキスト（游明朝体 Demibold 15pt）
  - 出典（人物名 + 背景の1行説明、ヒラギノ角ゴ W3 12pt）
  - お気に入りアイコン（右端）
お気に入りデータ: UserDefaults に保存
```

---

## 7.10 フィードバック表示のTone別デザイン

フィードバック表示エリアのデザインは Tone（04_characters.md 4.5.1）に応じて変化する。

| Tone | 背景アクセント | 装飾ラインの色 | キャラアイコン枠の色 | 使用場面 |
|---|---|---|---|---|
| positive | `#B8860B` opacity 0.05 | 金茶 `#B8860B` | 金茶 | praise, celebrate |
| negative | `#C13B2A` opacity 0.05 | 朱 `#C13B2A` | 朱 | rebuke, warn |
| neutral | `#1B4B6B` opacity 0.05 | 藍 `#1B4B6B` | 藍 | advise, encourage |
| celebratory | `#B8860B` opacity 0.10 | 金茶 `#B8860B`（太め1pt）| 金茶 + グロー | milestone |

---

## 7.11 マイルストーン達成画面の詳細仕様

04_characters.md 4.4.2 の解放演出仕様に準拠。

```
┌──────────────────────────────────────┐
│                                      │
│         (金色の光が広がる)            │  背景: 墨色 → 金色グロー（1.5s）
│                                      │
│                                      │
│          — 西国無双 —                 │  マイルストーン名
│                                      │  游明朝体 Demibold 24pt、金茶
│          六十六日                     │
│                                      │
│  紹運「六十六日。                     │  セリフ表示:
│   我が息子よ、                       │  タイプライター風（50ms/文字）
│   お主はもう"西国無双"だ。」          │  游明朝体 Demibold 17pt
│                                      │
│                                      │
│         (タップで閉じる)              │  自動では閉じない
│                                      │
└──────────────────────────────────────┘

サウンド（ON時）: 太鼓の一打ち
ハプティクス: UINotificationFeedbackGenerator(.success)
閉じ方: 画面タップで閉じる → ホーム画面に戻る
```

---

## 7.12 エラーハンドリングUI

### 7.12.1 データ保存失敗

```
SwiftData への書き込みが失敗した場合:
  → Alert「データの保存に失敗しました」
  → メッセージ: 「端末の空き容量をご確認ください」
  → ボタン: 「再試行」「閉じる」
  → 入力データはメモリ上に保持（アプリ終了まで）
```

### 7.12.2 通知権限拒否

```
設定画面に警告バナーを表示:
  「通知が無効です。設定アプリで通知を許可してください」
  → タップで UIApplication.openSettingsURLString を起動
  → ホーム画面にはバナーを表示しない（控えめ）
```

### 7.12.3 AI API エラー

```
Claude API エラー時:
  → テンプレートベースにサイレントフォールバック
  → ユーザーにはフォールバックであることを明示しない

APIキー無効時:
  → 設定画面の AI セクションに「APIキーが無効です」テキスト表示
  → 再入力を促すリンク
```

---

## 7.13 アクセシビリティ方針（v1.1）

| 対応項目 | 方針 |
|---|---|
| **VoiceOver** | 全インタラクティブ要素にアクセシビリティラベルを設定。スコアボタン: 「{項目名}, スコア {N}」 |
| **Dynamic Type** | 武士セリフを除くUIテキストは Dynamic Type 対応。游明朝体は固定サイズを維持 |
| **コントラスト比** | WCAG AA 準拠（4.5:1 以上）。朱色 `#C13B2A` on 墨色 `#1A1A1A` = 4.8:1（AA 達成） |
| **Reduce Motion** | アニメーション設定がオフの場合、全アニメーションをスキップ |
| **色覚多様性** | スコアは色だけでなく数値でも表示。レーダーチャートは形状でも区別可能に |

---

## 7.14 MVPスコープ定義（UI/UX）

| 機能 | MVP | v1.1 | v1.2 |
|---|---|---|---|
| オンボーディング（5画面） | YES | | |
| ホーム画面（名言カード + モード選択） | YES | | |
| Quick / Deep チェック入力 | YES | | |
| デイリーサマリー（レーダーチャート + フィードバック） | YES | | |
| フィードバック詳細画面 | YES | | |
| マイルストーン達成画面 | YES | | |
| 名言一覧（お気に入り機能） | YES | | |
| 設定画面（通知 + AI + アプリ情報） | YES | | |
| ダークモード（デフォルト・ダークのみ） | YES | | |
| ホーム画面ウィジェット（Small / Medium） | YES | | |
| ストリーク表示 + ウィジェット（Small） | YES | | |
| 入力中断時の一時保存（ドラフト） | YES | | |
| 週次サマリー画面 | | YES | |
| ダッシュボード（週次 / 月次 / ロングターム） | | YES | |
| 項目詳細画面 | | YES | |
| CSV エクスポート | | YES | |
| ライトモード対応 | | YES | |
| カテゴリウィジェット（Medium） | | YES | |
| ロック画面ウィジェット（Inline / Circular） | | YES | |
| カスタムアイコンセット | | YES | |
| アクセシビリティ対応（VoiceOver / Dynamic Type） | | YES | |
| エビデンス参照カード（ロングプレスで表示） | | | YES |
| サウンドエフェクト（鈴・太鼓） | | | YES |
| 和紙テクスチャの洗練 | | | YES |
